SET PATH=C:\MASM615\BIN

SET PATHC=C:\MSVC20\BIN\
SET INCLUDE=C:\MSVC20\INCLUDE;C:\MSVC20\MFC\INCLUDE
SET LIB=C:\MSVC20\LIB;C:\MSVC20\MFC\LIB

SET BOOT_PATH=..\BOOT\
SET TOOLS_PATH=..\TOOLS\
SET KERNEL_PATH=..\KERNEL\

SET DEBUG_PATH=..\DEBUG\
SET LIB_PATH=..\LIB\
SET INCLUDE_PATH=..\INCLUDE\
SET INC_PATH=..\KERNEL\INC

SET IMAGE_NAME=KERNEL32.EXE

IF NOT EXIST %LIB_PATH%MICROSO.LIB (
	MKDIR %LIB_PATH%
)

ML /AT /I %INC_PATH% /c %BOOT_PATH%FAT32.ASM
LINK /NOD /TINY FAT32.OBJ, FAT32.BIN,,,,
ML /c /I %INC_PATH% %KERNEL_PATH%KERNEL.ASM
LINK /NOD KERNEL.OBJ, KERNEL.SYS,,,,

ML /c %DEBUG_PATH%FUNCTION.ASM
REN FUNCTION.OBJ FUNCASM.OBJ

%PATHC%CL /O2 /I %INCLUDE_PATH% /D "ARCH_X86" /X /MT /Zp1 /FAs /W4 /c /Gd /Oy %KERNEL_PATH%CRT0.CPP
%PATHC%CL /O2 /I %INCLUDE_PATH% /D "ARCH_X86" /X /MT /Zp1 /FAs /W4 /c /Gd /Oy %DEBUG_PATH%FUNCTION.CPP
%PATHC%CL /O2 /I %INCLUDE_PATH% /D "ARCH_X86" /X /MT /Zp1 /FAs /W4 /c /Gd /Oy %KERNEL_PATH%KERNEL32.CPP

%PATHC%LIB /OUT:%LIB_PATH%MICROSO.LIB FUNCASM.OBJ FUNCTION.OBJ 

%PATHC%LINK /OUT:%IMAGE_NAME% /INCREMENTAL:NO /NODEFAULTLIB /MAP:"KERNEL.MAP" /SUBSYSTEM:NATIVE /OPT:REF /ENTRY:"mainCRTStart" /BASE:"0x100000" /ALIGN:512 %LIB_PATH%MICROSO.LIB CRT0.OBJ KERNEL32.OBJ

PAUSE
DEL *.OBJ *.MAP *.ASM