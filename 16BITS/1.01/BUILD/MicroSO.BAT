@ECHO OFF
SET WinImage="%ProgramFiles%\WinImage\WinImage.exe"
SET WinImagex86="%ProgramFiles(x86)%\WinImage\WinImage.exe"

IF NOT EXIST %WinImage% (
	IF NOT EXIST %WinImagex86% (
		ECHO Install first WinImage
		GOTO END
	) ELSE (
		ECHO Install first WinImage
		GOTO END
	)
) 

ECHO ### INSTALANDO O MICRO SO 1.01 - 16 BITS ###
@ECHO ON

..\..\TOOLS\VC152\ML.EXE /AT /c ..\BOOT\FAT12.ASM
..\..\TOOLS\VC152\LINK.EXE /TINY /NOD FAT12.obj, FAT12.BIN,,,,
IF "%PROCESSOR_ARCHITECTURE%" == "x86" (
	SET PATH="%ProgramFiles%\WinImage";"%ProgramFiles(x86)%\WinImage"
) ELSE (
	SET PATH="%ProgramFiles%\WinImage";	
)

..\..\TOOLS\PTBIN\DD if=fat12.bin of=microso.img bs=512 count=1
..\..\TOOLS\VC152\ML.EXE /AT /c ..\KERNEL\KERNEL.ASM
..\..\TOOLS\VC152\LINK.EXE /TINY /NOD KERNEL.obj, KERNEL.SYS,,,,
..\..\TOOLS\VC152\ML.EXE /AT /c ..\CMD\COMMAND.ASM
..\..\TOOLS\VC152\LINK.EXE /TINY /NOD COMMAND.obj, COMMAND.COM,,,,
..\..\TOOLS\VC152\ML.EXE /AT /c ..\PROGRAMS\ASM\EDIT.ASM
..\..\TOOLS\VC152\LINK.EXE /TINY /NOD EDIT.obj, EDIT.COM,,,,
..\..\TOOLS\VC152\ML.EXE /c ..\PROGRAMS\ASM\MODELO.ASM
..\..\TOOLS\VC152\LINK.EXE /NOD MODELO.obj, WORLD.EXE,,,,
..\..\TOOLS\VC152\ML.EXE /AT /c ..\PROGRAMS\ASM\LOADCOM.ASM
..\..\TOOLS\VC152\LINK.EXE /TINY /NOD LOADCOM.obj, LOADCOM.COM,,,,
..\..\TOOLS\VC152\ML.EXE /c ..\PROGRAMS\ASM\LOADEXE.ASM
..\..\TOOLS\VC152\LINK.EXE /NOD LOADEXE.obj, LOADEXE.EXE,,,,
..\..\TOOLS\VC152\ML.EXE /AT /c ..\PROGRAMS\ASM\MEMVIEW.ASM
..\..\TOOLS\VC152\LINK.EXE /TINY /NOD MEMVIEW.obj, MEMVIEW.COM,,,,
..\..\TOOLS\VC152\ML.EXE /AT /c ..\PROGRAMS\ASM\ATARI.ASM
..\..\TOOLS\VC152\LINK.EXE /TINY /NOD ATARI.obj, ATARI.COM,,,,
..\..\TOOLS\VC152\ML.EXE /AT /c ..\PROGRAMS\ASM\CHAT.ASM
..\..\TOOLS\VC152\LINK.EXE /TINY /NOD CHAT.obj, CHAT.COM,,,,
..\..\TOOLS\VC152\ML.EXE /AT /c  ..\LIB\C0T.ASM ..\LIB\STDIO.ASM
..\..\TOOLS\VC152\ML.EXE /AT /c /Zm ..\MOUSE\PS2\PSMOUSE.ASM
..\..\TOOLS\VC152\ML.EXE /AT /c ..\MOUSE\SERIAL\MOUSE.ASM
..\..\TOOLS\VC152\ML.EXE /c ..\PROGRAMS\ASM\PE2OBJ\PEMAIN.ASM
..\..\TOOLS\VC152\ML.EXE /c ..\PROGRAMS\ASM\PE2OBJ\PEFUN.ASM
..\..\TOOLS\VC152\LINK.EXE /NOD PEMAIN.OBJ PEFUN.OBJ, PEMAIN.EXE,,,,
..\..\TOOLS\VC152\LINK.EXE /TINY PSMOUSE.OBJ, PSMOUSE.COM,,,,
..\..\TOOLS\VC152\LINK.EXE /TINY MOUSE.OBJ, MOUSE.COM,,,,
COPY ..\INCLUDE\STDIO.H STDIO.H
COPY ..\PROGRAMS\C\HELLO.C HELLO.C
..\..\TOOLS\VC152\CL.EXE /AT /G2 /Gs /Gx /c /Zl *.C
..\..\TOOLS\VC152\LIB.EXE STDIO.LIB +STDIO.OBJ,
..\..\TOOLS\VC152\LINK.EXE /TINY /NOD C0T.OBJ HELLO.OBJ STDIO.LIB, HELLO.COM,,,,

WINIMAGE MICROSO.IMG /I /Q /H KERNEL.SYS
WINIMAGE MICROSO.IMG /I /Q /H COMMAND.COM

WINIMAGE MICROSO.IMG /I /Q /H LOADCOM.COM
WINIMAGE MICROSO.IMG /I /Q /H LOADEXE.EXE

WINIMAGE MICROSO.IMG /I /Q /H MEMVIEW.COM
WINIMAGE MICROSO.IMG /I /Q /H PSMOUSE.COM

WINIMAGE MICROSO.IMG /I /Q /H ATARI.COM
WINIMAGE MICROSO.IMG /I /Q /H WORLD.EXE

WINIMAGE MICROSO.IMG /I /Q /H HELLO.COM
WINIMAGE MICROSO.IMG /I /Q /H CHAT.COM

WINIMAGE MICROSO.IMG /I /Q /H EDIT.COM
WINIMAGE MICROSO.IMG /I /Q /H MOUSE.COM

ECHO OFF
DEL *.OBJ *.MAP *.C *.H *.EXE *.COM *.BIN *.SYS *.LIB

ECHO -- IMAGEM ATUALIZADA COM SUCESSO --
:END
PAUSE