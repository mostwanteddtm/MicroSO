ECHO *** BASEADO NO KERNEL v1.04 ***

SET PATH=C:\MASM615\BIN

SET PATHC=C:\MSVC20\BIN\
SET INCLUDE=C:\MSVC20\INCLUDE;C:\MSVC20\MFC\INCLUDE
SET LIB=C:\MSVC20\LIB;C:\MSVC20\MFC\LIB

SET IMAGE_NAME=KERNEL32.EXE

SET LANGUAGE=ASM

ML /c /coff CRT1.ASM
%PATHC%CL /O2 /X /MT /Zp1 /FAs /W4 /c /Gd /Oy CRT0.CPP

IF %LANGUAGE% == ASM (
	%PATHC%LINK /OUT:%IMAGE_NAME% /INCREMENTAL:NO /NODEFAULTLIB /MAP:"KERNEL.MAP" /SUBSYSTEM:NATIVE /OPT:REF /ENTRY:"main" /BASE:"0x100000" /ALIGN:512 %CRT1.OBJ
) ELSE (
	%PATHC%LINK /OUT:%IMAGE_NAME% /INCREMENTAL:NO /NODEFAULTLIB /MAP:"KERNEL.MAP" /SUBSYSTEM:NATIVE /OPT:REF /ENTRY:"main" /BASE:"0x100000" /ALIGN:512 %CRT0.OBJ
)

.\TOOL\DD if=fat12.bin of=\\.\A: bs=512 count=1

COPY KERNEL.SYS A:
COPY KERNEL32.EXE A: