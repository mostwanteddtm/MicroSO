<!DOCTYPE html>
<!-- saved from url=(0036)https://www.lowlevel.eu/wiki/RTL8139 -->
<html class="client-js translated-ltr" lang="pt" dir="ltr"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>RTL8139 - nível baixo</title>
<script>document.documentElement.className = document.documentElement.className.replace( /(^|\s)client-nojs(\s|$)/, "$1client-js$2" );</script>
<script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgCanonicalNamespace":"","wgCanonicalSpecialPageName":false,"wgNamespaceNumber":0,"wgPageName":"RTL8139","wgTitle":"RTL8139","wgCurRevisionId":11297,"wgRevisionId":11297,"wgArticleId":1533,"wgIsArticle":true,"wgIsRedirect":false,"wgAction":"view","wgUserName":null,"wgUserGroups":["*"],"wgCategories":["Tutorials","Netzwerkkarte"],"wgBreakFrames":false,"wgPageContentLanguage":"de","wgPageContentModel":"wikitext","wgSeparatorTransformTable":[",\t.",".\t,"],"wgDigitTransformTable":["",""],"wgDefaultDateFormat":"dmy","wgMonthNames":["","Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],"wgMonthNamesShort":["","Jan.","Feb.","Mär.","Apr.","Mai","Jun.","Jul.","Aug.","Sep.","Okt.","Nov.","Dez."],"wgRelevantPageName":"RTL8139","wgRelevantArticleId":1533,"wgRequestId":"4ef1e836f97be0e38906a452","wgIsProbablyEditable":false,"wgRelevantPageIsProbablyEditable":false,"wgRestrictionEdit":[],"wgRestrictionMove":[]});mw.loader.state({"site.styles":"ready","noscript":"ready","user.styles":"ready","user":"ready","site":"ready","user.options":"loading","user.tokens":"loading","mediawiki.legacy.shared":"ready","mediawiki.legacy.commonPrint":"ready","mediawiki.sectionAnchor":"ready","mediawiki.skinning.interface":"ready","mediawiki.skinning.content.externallinks":"ready","skins.monobook.styles":"ready"});mw.loader.implement("user.options@1wzrrbt",function($,jQuery,require,module){/*@nomin*/mw.user.options.set({"variant":"de"});
});mw.loader.implement("user.tokens@0sm3ue4",function($,jQuery,require,module){/*@nomin*/mw.user.tokens.set({"editToken":"+\\","patrolToken":"+\\","watchToken":"+\\","csrfToken":"+\\"});
});mw.loader.load(["mediawiki.page.startup","mediawiki.user","mediawiki.hidpi","mediawiki.page.ready","mediawiki.toc","mediawiki.searchSuggest"]);});</script>
<link rel="stylesheet" href="./RTL8139__LowLevel_PtBr_files/load.php">
<script async="" src="./RTL8139__LowLevel_PtBr_files/load(1).php"></script>
<!--[if IE 6]><link rel="stylesheet" href="/w/skins/MonoBook/resources/IE60Fixes.css?303" media="screen"/><![endif]--><!--[if IE 7]><link rel="stylesheet" href="/w/skins/MonoBook/resources/IE70Fixes.css?303" media="screen"/><![endif]-->
<style>
.suggestions{overflow:hidden;position:absolute;top:0;left:0;width:0;border:0;z-index:1099;padding:0;margin:-1px 0 0 0}.suggestions-special{position:relative;background-color:#fff;cursor:pointer;border:1px solid #a2a9b1;margin:0;margin-top:-2px;display:none;padding:0.25em 0.25em;line-height:1.25em}.suggestions-results{background-color:#fff;cursor:pointer;border:1px solid #a2a9b1;padding:0;margin:0}.suggestions-result{color:#000;margin:0;line-height:1.5em;padding:0.01em 0.25em;text-align:left; overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.suggestions-result-current{background-color:#2a4b8d;color:#fff}.suggestions-special .special-label{color:#72777d;text-align:left}.suggestions-special .special-query{color:#000;font-style:italic;text-align:left}.suggestions-special .special-hover{background-color:#c8ccd1}.suggestions-result-current .special-label,.suggestions-result-current .special-query{color:#fff}.highlight{font-weight:bold}
@media screen {
	.tochidden,.toctoggle{-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.toctoggle{font-size:94%}}
@media print {
	.toc.tochidden,.toctoggle{display:none}}</style><style>
.suggestions a.mw-searchSuggest-link,.suggestions a.mw-searchSuggest-link:hover,.suggestions a.mw-searchSuggest-link:active,.suggestions a.mw-searchSuggest-link:focus{color:#000;text-decoration:none}.suggestions-result-current a.mw-searchSuggest-link,.suggestions-result-current a.mw-searchSuggest-link:hover,.suggestions-result-current a.mw-searchSuggest-link:active,.suggestions-result-current a.mw-searchSuggest-link:focus{color:#fff}.suggestions a.mw-searchSuggest-link .special-query{ overflow:hidden;text-overflow:ellipsis;white-space:nowrap}</style><meta name="ResourceLoaderDynamicStyles" content="">
<link rel="stylesheet" href="./RTL8139__LowLevel_PtBr_files/load(2).php">
<meta name="generator" content="MediaWiki 1.31.7">
<link rel="shortcut icon" href="https://www.lowlevel.eu/Favicon.png">
<link rel="search" type="application/opensearchdescription+xml" href="https://www.lowlevel.eu/w/opensearch_desc.php" title="Nível baixo (de)">
<link rel="EditURI" type="application/rsd+xml" href="https://www.lowlevel.eu/w/api.php?action=rsd">
<link rel="license" href="https://creativecommons.org/licenses/by-nc-sa/3.0/de/">
<link rel="alternate" type="application/atom+xml" title="Feed Atom para &quot;nível baixo&quot;" href="https://www.lowlevel.eu/w/index.php?title=Spezial:Letzte_%C3%84nderungen&amp;feed=atom">
<!--[if lt IE 9]><script src="/w/load.php?debug=false&amp;lang=de&amp;modules=html5shiv&amp;only=scripts&amp;skin=monobook&amp;sync=1"></script><![endif]-->
<script src="./RTL8139__LowLevel_PtBr_files/load(3).php"></script><link type="text/css" rel="stylesheet" charset="UTF-8" href="./RTL8139__LowLevel_PtBr_files/translateelement.css"></head>
<body class="mediawiki ltr sitedir-ltr capitalize-all-nouns mw-hide-empty-elt ns-0 ns-subject page-RTL8139 rootpage-RTL8139 skin-monobook action-view"><div id="globalWrapper"><div id="column-content"><div id="content" class="mw-body" role="main"><a id="top"></a><div class="mw-indicators mw-body-content">
</div>
<h1 id="firstHeading" class="firstHeading" lang="de"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTL8139</font></font></h1><div id="bodyContent" class="mw-body-content"><div id="siteSub"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">De baixo nível</font></font></div><div id="contentSub" lang="de" dir="ltr"></div><div id="jump-to-nav" class="mw-jump"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ir para: </font></font><a href="https://www.lowlevel.eu/wiki/RTL8139#column-one"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">navegação</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> , </font></font><a href="https://www.lowlevel.eu/wiki/RTL8139#searchInput"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">pesquisa</font></font></a></div><!-- start content --><div id="mw-content-text" lang="de" dir="ltr" class="mw-content-ltr"><div class="mw-parser-output"><div id="toc" class="toc"><div class="toctitle" lang="de" dir="ltr"><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sumário</font></font></h2><span class="toctoggle"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&nbsp;[ </font></font><a role="button" tabindex="0" class="togglelink"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ocultar</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> ]&nbsp;</font></font></span></div>
<ul>
<li class="toclevel-1 tocsection-1"><a href="https://www.lowlevel.eu/wiki/RTL8139#Grunds.C3.A4tzliches"><span class="tocnumber"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1 </font></font></span> <span class="toctext"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Noções básicas</font></font></span></a>
<ul>
<li class="toclevel-2 tocsection-2"><a href="https://www.lowlevel.eu/wiki/RTL8139#Voraussetzungen"><span class="tocnumber"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.1 </font></font></span> <span class="toctext"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Requisitos</font></font></span></a></li>
<li class="toclevel-2 tocsection-3"><a href="https://www.lowlevel.eu/wiki/RTL8139#Funktionweise"><span class="tocnumber"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">1.2 </font></font></span> <span class="toctext"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como funciona</font></font></span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-4"><a href="https://www.lowlevel.eu/wiki/RTL8139#Initialisierung"><span class="tocnumber"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2 </font></font></span> <span class="toctext"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">inicialização</font></font></span></a></li>
<li class="toclevel-1 tocsection-5"><a href="https://www.lowlevel.eu/wiki/RTL8139#Senden_eines_Pakets"><span class="tocnumber"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">3 </font></font></span> <span class="toctext"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Envie um pacote</font></font></span></a></li>
<li class="toclevel-1 tocsection-6"><a href="https://www.lowlevel.eu/wiki/RTL8139#Empfangen"><span class="tocnumber"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">4 </font></font></span> <span class="toctext"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Receber</font></font></span></a></li>
<li class="toclevel-1 tocsection-7"><a href="https://www.lowlevel.eu/wiki/RTL8139#Sonstiges"><span class="tocnumber"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5 </font></font></span> <span class="toctext"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">outros</font></font></span></a>
<ul>
<li class="toclevel-2 tocsection-8"><a href="https://www.lowlevel.eu/wiki/RTL8139#MAC-Adresse"><span class="tocnumber"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">5.1 </font></font></span> <span class="toctext"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">endereço MAC</font></font></span></a></li>
</ul>
</li>
<li class="toclevel-1 tocsection-9"><a href="https://www.lowlevel.eu/wiki/RTL8139#Siehe_auch"><span class="tocnumber"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">6 </font></font></span> <span class="toctext"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Veja também</font></font></span></a></li>
<li class="toclevel-1 tocsection-10"><a href="https://www.lowlevel.eu/wiki/RTL8139#Weblinks"><span class="tocnumber"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">7 </font></font></span> <span class="toctext"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">links da web</font></font></span></a></li>
</ul>
</div>

<h2><span id="Grundsätzliches"></span><span class="mw-headline" id="Grunds.C3.A4tzliches"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Noções básicas</font></font></span></h2>
<h3><span class="mw-headline" id="Voraussetzungen"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Exigências</font></font></span></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Estou supondo que alguém planejando escrever um driver de rede para o chip RTL8139 com este tutorial já esteja em um determinado nível com o sistema deles. </font><font style="vertical-align: inherit;">Noções básicas, como recebimento de IRQs ou gerenciamento de memória, são óbvias e também deve haver uma maneira de descobrir IRQs e portas de dispositivos PCI.
</font></font></p><p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Eu recomendo o qemu como um emulador. </font><font style="vertical-align: inherit;">Você deve especificar os parâmetros -net na linha de comandos, por exemplo:
</font></font></p>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">qemu -fda lost.img -net nic, model = rtl8139 -net user</font></font></pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Com esses parâmetros, o qemu emula uma placa de rede com um chipset RTL8139, localizado em uma rede virtual. </font><font style="vertical-align: inherit;">Você pode acessar a Internet grande e ampla através do roteador qemu virtual no endereço IP 10.0.2.2.
</font></font></p>
<h3><span class="mw-headline" id="Funktionweise"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como funciona</font></font></span></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Como já mencionado, o chipset usa recursos diferentes:
</font></font></p>
<ul><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Portas: os registros da placa de rede, através dos quais a configuração básica é realizada, podem ser endereçados pelas portas de E / S.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">IRQ: Entre outras coisas, um IRQ é acionado assim que um pacote Ethernet chega ou um pacote é enviado.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Memória: Um buffer de toque na memória principal é usado para enviar e receber. </font><font style="vertical-align: inherit;">Buffer de anel significa que o buffer é preenchido normalmente do início ao fim. </font><font style="vertical-align: inherit;">Posteriormente, o processo é iniciado novamente no início do buffer e continua sendo preenchido (se os dados antigos foram processados ​​lá, caso contrário, ocorrerá um erro).</font></font></li></ul>
<h2><span class="mw-headline" id="Initialisierung"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inicialização</font></font></span></h2>
<ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Obtenha as portas IRQ e E / S do driver PCI</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Registre o manipulador de IRQ e as portas de E / S, se aplicável</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Execute uma redefinição do cartão: defina o bit 4 no registro de comandos (0x37, 1 byte). </font><font style="vertical-align: inherit;">Quando digito aqui os números das portas de registro, significa o deslocamento para a primeira porta da placa que deve ser determinada pelas funções PCI.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ativando o transmissor e o receptor: Defina os bits 2 e 3 (TE ou RE) no registro de comandos (0x37, 1 byte). </font><font style="vertical-align: inherit;">Diz-se que isso não acontecerá mais tarde, caso contrário, os seguintes comandos serão ignorados.</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Defina TCR (Transmit Configuration Register, 0x40, 4 bytes) e RCR (Receive Configuration Register, 0x44, 4 bytes). </font><font style="vertical-align: inherit;">Neste momento, não há mais comentários: TCR = 0x03000700, RCR = 0x0000070a</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inicialize buffers para recepção (possivelmente também para envio, mas isso também pode acontecer posteriormente). </font><font style="vertical-align: inherit;">Com os valores sugeridos, precisamos de 8K + 16 bytes para o buffer de recebimento e um buffer de envio suficientemente grande. </font><font style="vertical-align: inherit;">O que significa suficiente depende de quanto queremos enviar de uma só vez. </font><font style="vertical-align: inherit;">Em seguida, o endereço físico (!) Do buffer de recebimento deve ser gravado em RBSTART (0x30, 4 bytes).</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Defina a máscara de interrupção (0x3C, 2 bytes). </font><font style="vertical-align: inherit;">Os eventos que devem acionar um IRQ podem ser selecionados neste registro. </font><font style="vertical-align: inherit;">Por uma questão de simplicidade, pegamos tudo e definimos 0xffff.</font></font></li></ol>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Constantes do código do título: &lt;c&gt; // número da porta dos registradores
</font></font></p>
<ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">definir REG_ID0 0x00</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">definir REG_ID4 0x04</font></font></li></ol>
<ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">definir REG_TRANSMIT_STATUS0 0x10</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">definir REG_TRANSMIT_ADDR0 0x20</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">definir REG_RECEIVE_BUFFER 0x30</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">definir REG_COMMAND 0x37</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">definir REG_CUR_READ_ADDR 0x38</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">definir REG_INTERRUPT_MASK 0x3C</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">definir REG_INTERRUPT_STATUS 0x3E</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">definir REG_TRANSMIT_CONFIGURATION 0x40</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">definir REG_RECEIVE_CONFIGURATION 0x44</font></font></li></ol>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">// valores para os registradores // registradores de controle
</font></font></p>
<ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">defina CR_RESET (1 &lt;&lt; 4)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">definir CR_RECEIVER_ENABLE (1 &lt;&lt; 3)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">definir CR_TRANSMITTER_ENABLE (1 &lt;&lt; 2)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">definir CR_BUFFER_IS_EMPTY (1 &lt;&lt; 0)</font></font></li></ol>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">// configuração do transmissor
</font></font></p>
<ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">defina TCR_IFG_STANDARD (3 &lt;&lt; 24)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">define TCR_MXDMA_512 (5 &lt;&lt; 8)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">definir TCR_MXDMA_1024 (6 &lt;&lt; 8)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">definir TCR_MXDMA_2048 (7 &lt;&lt; 8)</font></font></li></ol>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">// Configuração do receptor
</font></font></p>
<ol><li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">define RCR_MXDMA_512 (5 &lt;&lt; 8)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">define RCR_MXDMA_1024 (6 &lt;&lt; 8)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">define RCR_MXDMA_UNLIMITED (7 &lt;&lt; 8)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">define RCR_ACCEPT_BROADCAST (1 &lt;&lt; 3)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">defina RCR_ACCEPT_MULTICAST (1 &lt;&lt; 2)</font></font></li>
<li>define RCR_ACCEPT_PHYS_MATCH   (1 &lt;&lt; 1)</li></ol>
<p>// Interrupt-Statusregister
</p>
<ol><li>define ISR_RECEIVE_BUFFER_OVERFLOW     (1 &lt;&lt; 4)</li>
<li>define ISR_TRANSMIT_OK                 (1 &lt;&lt; 2)</li>
<li>define ISR_RECEIVE_OK                  (1 &lt;&lt; 0)</li></ol>
<p>&lt;/c&gt;
</p>
<h2><span class="mw-headline" id="Senden_eines_Pakets">Senden eines Pakets</span></h2>
<p>Senden ist eigentlich eine ganz einfache Übung, nachdem alles konfiguriert ist. Wir brauchen spätestens hier einen Sendepuffer, von dem wir die physische Adresse wissen. Anschließend müssen wir einfach der Netzwerkkarte diese Adresse geben.
</p><p>Eine Besonderheit gibt es noch zu erwähnen: Ringpuffer überall. Die Karte kennt vier Deskriptoren für das Senden, die immer brav der Reihe nach benutzt werden müssen, ansonsten passiert einfach gar nichts. Das kann man durchaus ausnutzen, indem man den nächsten Puffer schon vorbereitet, solange der erste nicht komplett verschickt ist, für den Anfang reicht es aber, eins nach dem anderen zu machen.
</p><p>Zuerst muss die Adresse nach TSDx (vier Register ab 0x10, je 4 Bytes) geschrieben werden, anschließend muss in TSAD (vier Register ab 0x20, je 4 Bytes) die Größe der zu übertragenden Daten eingetragen werden (Bits 0-12). Gleichzeitig wird damit das Bit 13 (OWN) gelöscht, was die Übertragung anstößt.
</p><p>Im folgenden ein Codebeispiel, wie es in týndur benutzt wird:
&lt;c&gt;
</p>
<pre>   // Adresse und Größe des Buffers setzen
   // In TASD (REG_TRANSMIT_STATUS) wird das OWN-Bit gelöscht, was die
   // tatsächliche Übertragung anstößt.
   write_register_dword(netcard,
       REG_TRANSMIT_ADDR0 + (4 * netcard-&gt;cur_buffer),
       (dword) netcard-&gt;buffer.phys);
</pre>
<pre>   write_register_dword(netcard,
       REG_TRANSMIT_STATUS0 + (4 * netcard-&gt;cur_buffer),
       size);
</pre>
<pre>   // Die vier Deskriptoren müssen der Reihe nach verwendet werden,
   // auch wenn wir momentan nur einen einzigen Puffer verwenden
   // und immer warten.
   netcard-&gt;cur_buffer++;
   netcard-&gt;cur_buffer&nbsp;%= 4;
</pre>
<p>&lt;/c&gt;
</p><p>Sobald die Karte fertig ist, schickt sie einen IRQ und in ISR (0x3E, 2 Bytes) ist das Bit 2 (TOK = Transmit OK) gesetzt. Nachdem die nötigen Aktionen durchgeführt wurden (z.B. Puffer wieder freigeben) muss das Bit gelöscht werden. Bits in ISR werden dadurch gelöscht, dass man sie beim Schreiben setzt. Um TOK zu löschen, würde man also 0x04 nach ISR schreiben.
</p>
<h2><span class="mw-headline" id="Empfangen">Empfangen</span></h2>
<p>Sobald ein Paket eintrifft, wird ebenfalls ein IRQ ausgelöst und in ISR (0x3E, 2 Bytes) ist das Bit 0 (ROK = Receive OK) gesetzt. Auch hier gilt, dass das Bit nach erfolgter Behandlung des Interupts durch Schreiben von 0x01 nach ISR gelöscht werden möchte.
</p><p>Bei der Behandlung des Interrupts ist zu beachten, dass mehrere Pakete eingetroffen sein könnten. Daher müssen in einer Schleife solange Pakete eingelesen werden, bis Bit 0 (BUFE = Buffer Empty) im Befehlsregister (CR, 0x37, 1 Byte) gesetzt ist. 
</p>
<pre>Bytes 0-1:     Paketheader (Bit 0 = ROK)
Bytes 2-3:     Länge des Pakets
Bytes 4-n:     Daten (Payload)
Bytes n+1-n+4: CRC-Prüfsumme
</pre>
<p>Was wir unbedingt wissen müssen, ist unsere aktuelle Position im Ringpuffer (am Anfang 0). An dieser Stelle können wir zwei Bytes Paketheader abholen (Bit 0 = ROK sollte dort gesetzt sein) und darauf folgend zwei Bytes Länge abholen. Entsprechend viele Bytes folgen anschließend noch, die das eigentliche Paket und am Ende vier Bytes CRC-Prüfsumme enthalten (letztere kann man einfach ignorieren). 
</p><p>Beim Auslesen der Daten ist unbedingt zu beachten, dass es sich um einen Ringpuffer handelt. Das bedeutet, dass sich irgendwo in der Mitte der Daten der Umbruch befinden könnte, wo es wieder bei Null losgeht. Durch anfängliches Ignorieren dieser Tatsache habe ich meinen Treiber in LOST schon abstürzen lassen.
</p><p>Anschließend muss der Netzwerkkarte mitgeteilt werden, dass wir etwas gelesen haben. Dazu schreiben wir in das Register CAPR (Current Address of Packet Read, 0x38, 2 Bytes) das Offset des nächsten erwarteten Pakets:
</p><p>&lt;c&gt;
</p>
<pre>   // Den aktuellen Offset im Lesepuffer anpassen. Jedes Paket ist
   // dword-aligned, daher anschließend Aufrundung.
   netcard-&gt;rx_buffer_offset += length + 4;
   netcard-&gt;rx_buffer_offset = (netcard-&gt;rx_buffer_offset + 3) &amp; ~0x3;
</pre>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">   // captura </font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
   transborda netcard-&gt; rx_buffer_offset% = 0x2000;</font></font>
</pre>
<pre><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">   write_register_word (cartão de rede, REG_CUR_READ_ADDR, cartão de </font></font><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">
       rede-&gt; rx_buffer_offset - 0x10);</font></font>
</pre>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">&lt;/c&gt;
</font></font></p>
<h2><span class="mw-headline" id="Sonstiges"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Outros</font></font></span></h2>
<h3><span class="mw-headline" id="MAC-Adresse"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Endereço MAC</font></font></span></h3>
<p><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O endereço MAC é armazenado nos registradores IDR0 a IDR5 (0x00 a 0x05) e pode ser lido e definido lá.
</font></font></p>
<h2><span class="mw-headline" id="Siehe_auch"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Veja também</font></font></span></h2>
<ul><li><a href="https://www.lowlevel.eu/wiki/Ethernet" title="Ethernet"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ethernet</font></font></a></li></ul>
<h2><span class="mw-headline" id="Weblinks"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Links da Web</font></font></span></h2>
<ul><li><a rel="nofollow" class="external text" href="http://www.cs.usfca.edu/~cruse/cs326/RTL8139D_DataSheet.pdf"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Folha de dados do RTL8139</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> (capítulo 5: Descrição de todos os registros)</font></font></li>
<li><a rel="nofollow" class="external text" href="http://www.cs.usfca.edu/~cruse/cs326/RTL8139_ProgrammersGuide.pdf"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">RTL8139 (A / B) Guia de programação (V0.1)</font></font></a></li></ul>

<!-- 
NewPP limit report
Cached time: 20200512121826
Cache expiry: 86400
Dynamic content: false
CPU time usage: 0.008 seconds
Real time usage: 0.007 seconds
Preprocessor visited node count: 56/1000000
Preprocessor generated node count: 84/1000000
Post‐expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Highest expansion depth: 2/40
Expensive parser function count: 0/100
Unstrip recursion depth: 0/20
Unstrip post‐expand size: 209/5000000 bytes
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%    0.000      1 -total
-->
</div>
<!-- Saved in parser cache with key lowlevel_wiki:pcache:idhash:1533-0!canonical and timestamp 20200512121826 and revision id 11297
 -->
</div><div class="printfooter">
Abgerufen von „<a dir="ltr" href="http://www.lowlevel.eu/w/index.php?title=RTL8139&amp;oldid=11297">http://www.lowlevel.eu/w/index.php?title=RTL8139&amp;oldid=11297</a>“</div>
<div id="catlinks" class="catlinks" data-mw="interface"><div id="mw-normal-catlinks" class="mw-normal-catlinks"><a href="https://www.lowlevel.eu/wiki/Spezial:Kategorien" title="Especial: categorias"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Categorias</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> :</font></font><ul><li><a href="https://www.lowlevel.eu/wiki/Kategorie:Tutorials" title="Categoria: Tutoriais"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Tutoriais</font></font></a></li><li><a href="https://www.lowlevel.eu/wiki/Kategorie:Netzwerkkarte" title="Categoria: Placa de Rede"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Placa de rede</font></font></a></li></ul></div></div><!-- end content --><div class="visualClear"></div></div></div></div><div id="column-one" lang="de" dir="ltr"><h2><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Menu de navegação</font></font></h2><div role="navigation" class="portlet" id="p-cactions" aria-labelledby="p-cactions-label"><h3 id="p-cactions-label" lang="de" dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Visualizações</font></font></h3><div class="pBody"><ul lang="de" dir="ltr"><li id="ca-nstab-main" class="selected"><a href="https://www.lowlevel.eu/wiki/RTL8139" title="Mostrar conteúdo da página [alt-shift-c]" accesskey="c"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Side</font></font></a></li><li id="ca-talk"><a href="https://www.lowlevel.eu/wiki/Diskussion:RTL8139" rel="discussion" title="Discussão sobre o conteúdo da página [alt-shift-t]" accesskey="t"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Discussão</font></font></a></li><li id="ca-viewsource"><a href="https://www.lowlevel.eu/w/index.php?title=RTL8139&amp;action=edit" title="Este site está protegido.  O texto de origem ainda pode ser visualizado e copiado.  [alt-shift-e]" accesskey="e"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mostrar código fonte</font></font></a></li><li id="ca-history"><a href="https://www.lowlevel.eu/w/index.php?title=RTL8139&amp;action=history" title="Versões anteriores desta página [alt-shift-h]" accesskey="h"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Histórico de versões</font></font></a></li></ul></div></div><div role="navigation" class="portlet" id="p-personal" aria-labelledby="p-personal-label"><h3 id="p-personal-label" lang="de" dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Minhas ferramentas</font></font></h3><div class="pBody"><ul lang="de" dir="ltr"><li id="pt-login"><a href="https://www.lowlevel.eu/w/index.php?title=Spezial:Anmelden&amp;returnto=RTL8139" title="É bem-vindo se registrar, mas não é obrigatório.  [alt-shift-o]" accesskey="o"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Entrar</font></font></a></li></ul></div></div><div class="portlet" id="p-logo" role="banner"><a href="https://www.lowlevel.eu/wiki/Hauptseite" class="mw-wiki-logo" title="Página principal"></a></div><div role="navigation" class="portlet generated-sidebar" id="p-navigation" aria-labelledby="p-navigation-label"><h3 id="p-navigation-label" lang="de" dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Navegação</font></font></h3><div class="pBody"><ul lang="de" dir="ltr"><li id="n-mainpage"><a href="https://www.lowlevel.eu/wiki/Hauptseite" title="Mostrar página principal [alt-shift-z]" accesskey="z"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Página principal</font></font></a></li><li id="n-Lowlevel-Portal"><a href="https://www.lowlevel.eu/wiki/Lowlevel:Portal"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Portal de baixo nível</font></font></a></li><li id="n-Lowlevel-Forum"><a href="http://forum.lowlevel.eu/" rel="nofollow"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Fórum de baixo nível</font></font></a></li><li id="n-recentchanges"><a href="https://www.lowlevel.eu/wiki/Spezial:Letzte_%C3%84nderungen" title="Lista de alterações recentes neste wiki [alt-shift-r]" accesskey="r"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Mudanças recentes</font></font></a></li><li id="n-Zuf.C3.A4llige-Seite"><a href="https://www.lowlevel.eu/wiki/Spezial:Zuf%C3%A4llige_Seite"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Página aleatória</font></font></a></li><li id="n-Wiki-Crashkurs"><a href="https://www.lowlevel.eu/wiki/Wiki-Crashkurs"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Curso intensivo da Wiki</font></font></a></li></ul></div></div><div role="search" class="portlet" id="p-search"><h3 id="p-search-label" lang="de" dir="ltr"><label for="searchInput"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Pesquisar</font></font></label></h3><div class="pBody" id="searchBody"><form action="https://www.lowlevel.eu/w/index.php" id="searchform"><input type="hidden" value="Spezial:Suche" name="title"><input type="search" name="search" placeholder="Pesquisar nível baixo" title="Buscar Nível baixo [alt-shift-f]" accesskey="f" id="searchInput" autocomplete="off"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><input type="submit" name="go" value="Página de " title="Vá diretamente para a página com esse nome exato, se existir." id="searchGoButton" class="searchButton"></font></font>&nbsp; <font style="vertical-align: inherit;"><font style="vertical-align: inherit;"><input type="submit" name="fulltext" value="pesquisa" title="Procure por páginas que contenham este texto" id="mw-searchButton" class="searchButton"></font></font></form></div></div><div role="navigation" class="portlet" id="p-tb" aria-labelledby="p-tb-label"><h3 id="p-tb-label" lang="de" dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Ferramentas</font></font></h3><div class="pBody"><ul lang="de" dir="ltr"><li id="t-whatlinkshere"><a href="https://www.lowlevel.eu/wiki/Spezial:Linkliste/RTL8139" title="Lista de todas as páginas que possuem links aqui [alt-shift-j]" accesskey="j"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Links para esta página</font></font></a></li><li id="t-recentchangeslinked"><a href="https://www.lowlevel.eu/wiki/Spezial:%C3%84nderungen_an_verlinkten_Seiten/RTL8139" rel="nofollow" title="Últimas alterações nas páginas vinculadas daqui [alt-shift-k]" accesskey="k"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Alterações nas páginas vinculadas</font></font></a></li><li id="t-specialpages"><a href="https://www.lowlevel.eu/wiki/Spezial:Spezialseiten" title="Lista de todas as páginas especiais [alt-shift-q]" accesskey="q"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Páginas especiais</font></font></a></li><li id="t-print"><a href="https://www.lowlevel.eu/w/index.php?title=RTL8139&amp;printable=yes" rel="alternate" title="Visualizar impressão desta página [alt-shift-p]" accesskey="p"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Versão impressa</font></font></a></li><li id="t-permalink"><a href="https://www.lowlevel.eu/w/index.php?title=RTL8139&amp;oldid=11297" title="Link permanente para esta versão da página"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Link permanente</font></font></a></li><li id="t-info"><a href="https://www.lowlevel.eu/w/index.php?title=RTL8139&amp;action=info" title="Mais informações nesta página"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Informações da página</font></font></a></li></ul></div></div><div role="navigation" class="portlet" id="p-lang" aria-labelledby="p-lang-label"><h3 id="p-lang-label" lang="de" dir="ltr"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Em outros idiomas</font></font></h3><div class="pBody"><ul lang="de" dir="ltr"><li class="interlanguage-link interwiki-en"><a href="http://wiki.osdev.org/RTL8139" title="RTL8139 - Inglês" lang="en" hreflang="en" class="interlanguage-link-target"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Inglês</font></font></a></li></ul></div></div></div><!-- end of the left (by default at least) column --><div class="visualClear"></div><div id="footer" role="contentinfo" lang="de" dir="ltr"><div id="f-copyrightico" class="footer-icons"><a href="https://creativecommons.org/licenses/by-nc-sa/3.0/de/"><img src="./RTL8139__LowLevel_PtBr_files/88x31.png" alt="Atribuição - Sem uso comercial - Compartilhar igualmente 3.0 Alemanha" width="88" height="31"></a></div><div id="f-poweredbyico" class="footer-icons"><a href="https://www.mediawiki.org/"><img src="./RTL8139__LowLevel_PtBr_files/poweredby_mediawiki_88x31.png" alt="Desenvolvido por MediaWiki" srcset="/w/resources/assets/poweredby_mediawiki_132x47.png 1.5x, /w/resources/assets/poweredby_mediawiki_176x62.png 2x" width="88" height="31"></a></div><ul id="f-list"><li id="lastmod"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> Esta página foi editada pela última vez em 9 de outubro de 2015, às 18:00.</font></font></li><li id="copyright"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">O conteúdo está disponível sob a licença </font></font><a class="external" rel="nofollow" href="https://creativecommons.org/licenses/by-nc-sa/3.0/de/"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Atribuição - Nenhum uso comercial - Compartilhar da mesma forma 3.0 Alemanha,</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;"> salvo indicação em contrário.</font></font></li><li id="privacy"><a href="https://www.lowlevel.eu/wiki/Lowlevel:Datenschutz" title="Nível inferior: proteção de dados"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Protecção de dados</font></font></a></li><li id="about"><a href="https://www.lowlevel.eu/wiki/Lowlevel:%C3%9Cber_Lowlevel" title="Nível inferior: Sobre o nível inferior"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Sobre o nível baixo</font></font></a></li><li id="disclaimer"><a href="https://www.lowlevel.eu/wiki/Lowlevel:Impressum" title="Nível inferior: Impressão"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Isenção de responsabilidade</font></font></a></li></ul></div></div><script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgPageParseReport":{"limitreport":{"cputime":"0.008","walltime":"0.007","ppvisitednodes":{"value":56,"limit":1000000},"ppgeneratednodes":{"value":84,"limit":1000000},"postexpandincludesize":{"value":0,"limit":2097152},"templateargumentsize":{"value":0,"limit":2097152},"expansiondepth":{"value":2,"limit":40},"expensivefunctioncount":{"value":0,"limit":100},"unstrip-depth":{"value":0,"limit":20},"unstrip-size":{"value":209,"limit":5000000},"timingprofile":["100.00%    0.000      1 -total"]},"cachereport":{"timestamp":"20200512121826","ttl":86400,"transientcontent":false}}});});</script><script>(window.RLQ=window.RLQ||[]).push(function(){mw.config.set({"wgBackendResponseTime":163});});</script><div id="goog-gt-tt" class="skiptranslate" dir="ltr"><div style="padding: 8px;"><div><div class="logo"><img src="./RTL8139__LowLevel_PtBr_files/translate_24dp.png" width="20" height="20" alt="Google Tradutor"></div></div></div><div class="top" style="padding: 8px; float: left; width: 100%;"><h1 class="title gray">Texto original</h1></div><div class="middle" style="padding: 8px;"><div class="original-text"></div></div><div class="bottom" style="padding: 8px;"><div class="activity-links"><span class="activity-link">Sugerir uma tradução melhor</span><span class="activity-link"></span></div><div class="started-activity-container"><hr style="color: #CCC; background-color: #CCC; height: 1px; border: none;"><div class="activity-root"></div></div></div><div class="status-message" style="display: none;"></div></div><div class="suggestions" style="display: none; font-size: 11.4617px;"><div class="suggestions-results"></div><div class="suggestions-special"></div></div><div class="goog-te-spinner-pos"><div class="goog-te-spinner-animation"><svg xmlns="http://www.w3.org/2000/svg" class="goog-te-spinner" width="96px" height="96px" viewBox="0 0 66 66"><circle class="goog-te-spinner-path" fill="none" stroke-width="6" stroke-linecap="round" cx="33" cy="33" r="30"></circle></svg></div></div></body></html>