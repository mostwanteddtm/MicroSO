.286

CR		EQU 0Dh
LF		EQU 0Ah
SPACE 	EQU 20h

STCK SEGMENT STACK 'STACK'
	DB 100h DUP(0)
STCK ENDS

DATA SEGMENT PARA PUBLIC 'DATA' USE16
	BUFFER 		DB 200h DUP(?)
	FULLSCREEN	DW 190h
	SCRCOUNT	DW 0h
	TABLE		DB '0123456789ABCDEF'
	COUNTER 	DB 0
DATA ENDS

CODE SEGMENT PARA PUBLIC 'CODE' USE16
	ASSUME CS:CODE, DS:DATA, ES:DATA
	
	START PROC NEAR
	
		MOV		AX, SEG DATA
		MOV		DS, AX
		MOV		ES, AX
		
		MOV		SI, OFFSET BUFFER
		CALL	READDISK
		
	REPRINT::
	
		MOV		AX, 03h
		INT		10h
		MOV		CX, FULLSCREEN
	
	@@:
		LODSB
		CALL 	PRINT
		LOOP	@b
		
		MOV		DX, 1800h
		XOR		BX, BX
		MOV		AH, 02h
		INT		10h
		
		SUB		SI, 0Fh

	REFOUND::
		
		XOR		AX, AX
		INT		16h
		
		CMP		AH, 48h
		JE		MOVECUR
		CMP		AH, 50h
		JE		MOVECUR
		
		MOV		AX, 4C00h
		INT		21h
		
	START ENDP
	
	READDISK PROC NEAR
		
		MOV		AH, 02h
		MOV		AL, 01h
		MOV		CH, 00h				; CYLINDER
		MOV		DH, 01h				; HEAD
		MOV		CL, 01h				; SECTOR
		MOV		DL, 80h
		MOV		BX, OFFSET BUFFER
		INT		13h
		
		RET
		
	READDISK ENDP
	
	PRINT PROC NEAR
	
		MOV		DL, COUNTER
		CMP		DL, 10h
		JE		CRLF
	
	CPRINT::
	
		MOV		BX, OFFSET TABLE
		MOV		DL, AL
		RCR		AL, 4
		AND		AL, 0Fh
		XLATB
		MOV		AH, 0Eh
		INT		10h
		
		MOV		AL, DL
		AND		AL, 0Fh
		XLATB
		INT		10h
		
		MOV		AL, SPACE
		INT		10h
		
		INC 	COUNTER
		
		RET
	
	PRINT ENDP
	
	CRLF PROC NEAR
	
		PUSH	AX
	
		MOV 	AH, 0Eh
		MOV		AL, CR
		INT		10h
		
		MOV		AL, LF
		INT		10h
		
		MOV		COUNTER, 0
		
		POP		AX

		JMP		CPRINT
		
	CRLF ENDP
	
	MOVECUR PROC NEAR
	
		MOV		BL, AH
		MOV		AH, 03h
		MOV		BH, 00h
		INT		10h
		
		CMP		BL, 50h
		JE		@f
		CMP		DH, 00h
		JE		SCROLLUP		
		DEC		DH
		MOV 	DL, 00h
		MOV 	BH, 00h
		MOV 	AH, 02h
		INT 	10h
		
		JMP 	REFOUND
	
	@@:
		CMP		DH, 18h
		JE		SCROLLDOWN		
		INC		DH
		MOV 	DL, 00h
		MOV		BH, 00h
		MOV 	AH, 02h
		INT 	10h
		
		JMP		REFOUND
		
	MOVECUR	ENDP
	
	SCROLLUP PROC NEAR
	
		CMP		SCRCOUNT, 00h
		JLE		@f
		SUB		SCRCOUNT, 10h
		MOV		SI, OFFSET BUFFER
		ADD		SI, SCRCOUNT
		JMP 	REPRINT
		
	@@:
		MOV		SCRCOUNT, 0
		JMP		REFOUND
		
	SCROLLUP ENDP
	
	SCROLLDOWN PROC NEAR
	
		ADD		SCRCOUNT, 10h
		MOV		SI, OFFSET BUFFER
		ADD		SI, SCRCOUNT
		JMP 	REPRINT
	
	SCROLLDOWN ENDP
	
CODE ENDS

END START